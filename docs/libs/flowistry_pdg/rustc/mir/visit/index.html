<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="The MIR Visitor"><title>flowistry_pdg::rustc::mir::visit - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-47e7ab555ef2818a.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="flowistry_pdg" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0-nightly (58eefc33a 2023-08-24)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-b2d31d2efc7e9b67.css" data-theme-dark-css="dark-3388a2fb2ef8066b.css" data-theme-ayu-css="ayu-8c3c66a6cf12cb2f.css" ><script src="../../../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../../../static.files/main-ef3a2de404864b0b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../../static.files/light-b2d31d2efc7e9b67.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../../static.files/dark-3388a2fb2ef8066b.css"><link rel="stylesheet" href="../../../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../../flowistry_pdg/index.html"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../../flowistry_pdg/index.html"><img class="rust-logo" src="../../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module visit</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../../index.html">flowistry_pdg</a>::<wbr><a href="../../index.html">rustc</a>::<wbr><a href="../index.html">mir</a>::<wbr><a class="mod" href="#">visit</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_middle/mir/mod.rs.html#64">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="the-mir-visitor"><a href="#the-mir-visitor">The MIR Visitor</a></h2><h3 id="overview"><a href="#overview">Overview</a></h3>
<p>There are two visitors, one for immutable and one for mutable references,
but both are generated by the <code>make_mir_visitor</code> macro.
The code is written according to the following conventions:</p>
<ul>
<li>introduce a <code>visit_foo</code> and a <code>super_foo</code> method for every MIR type</li>
<li><code>visit_foo</code>, by default, calls <code>super_foo</code></li>
<li><code>super_foo</code>, by default, destructures the <code>foo</code> and calls <code>visit_foo</code></li>
</ul>
<p>This allows you to override <code>visit_foo</code> for types you are
interested in, and invoke (within that method call)
<code>self.super_foo</code> to get the default behavior. Just as in an OO
language, you should never call <code>super</code> methods ordinarily except
in that circumstance.</p>
<p>For the most part, we do not destructure things external to the
MIR, e.g., types, spans, etc, but simply visit them and stop. This
avoids duplication with other visitors like <code>TypeFoldable</code>.</p>
<h3 id="updating"><a href="#updating">Updating</a></h3>
<p>The code is written in a very deliberate style intended to minimize
the chance of things being overlooked. You’ll notice that we always
use pattern matching to reference fields and we ensure that all
matches are exhaustive.</p>
<p>For example, the <code>super_basic_block_data</code> method begins like this:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">fn </span>super_basic_block_data(
    <span class="kw-2">&amp;mut </span><span class="self">self</span>,
    block: BasicBlock,
    data: &amp; $(<span class="macro-nonterminal">$mutability</span>)<span class="question-mark">? </span>BasicBlockData&lt;<span class="lifetime">&#39;tcx</span>&gt;
) {
    <span class="kw">let </span>BasicBlockData {
        statements,
        terminator,
        is_cleanup: <span class="kw">_
    </span>} = <span class="kw-2">*</span>data;

    <span class="kw">for </span>statement <span class="kw">in </span>statements {
        <span class="self">self</span>.visit_statement(block, statement);
    }

    ...
}</code></pre></div>
<p>Here we used <code>let BasicBlockData { &lt;fields&gt; } = *data</code> deliberately,
rather than writing <code>data.statements</code> in the body. This is because if one
adds a new field to <code>BasicBlockData</code>, one will be forced to revise this code,
and hence one will (hopefully) invoke the correct visit methods (if any).</p>
<p>For this to work, ALL MATCHES MUST BE EXHAUSTIVE IN FIELDS AND VARIANTS.
That means you never write <code>..</code> to skip over fields, nor do you write <code>_</code>
to skip over variants in a <code>match</code>.</p>
<p>The only place that <code>_</code> is acceptable is to match a field (or
variant argument) that does not require visiting, as in
<code>is_cleanup</code> above.</p>
</div></details><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.MutatingUseContext.html" title="enum flowistry_pdg::rustc::mir::visit::MutatingUseContext">MutatingUseContext</a></div></li><li><div class="item-name"><a class="enum" href="enum.NonMutatingUseContext.html" title="enum flowistry_pdg::rustc::mir::visit::NonMutatingUseContext">NonMutatingUseContext</a></div></li><li><div class="item-name"><a class="enum" href="enum.NonUseContext.html" title="enum flowistry_pdg::rustc::mir::visit::NonUseContext">NonUseContext</a></div></li><li><div class="item-name"><a class="enum" href="enum.PlaceContext.html" title="enum flowistry_pdg::rustc::mir::visit::PlaceContext">PlaceContext</a></div></li><li><div class="item-name"><a class="enum" href="enum.TyContext.html" title="enum flowistry_pdg::rustc::mir::visit::TyContext">TyContext</a></div><div class="desc docblock-short">Extra information passed to <code>visit_ty</code> and friends to give context
about where the type etc appears.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.MirVisitable.html" title="trait flowistry_pdg::rustc::mir::visit::MirVisitable">MirVisitable</a></div></li><li><div class="item-name"><a class="trait" href="trait.MutVisitor.html" title="trait flowistry_pdg::rustc::mir::visit::MutVisitor">MutVisitor</a></div></li><li><div class="item-name"><a class="trait" href="trait.Visitor.html" title="trait flowistry_pdg::rustc::mir::visit::Visitor">Visitor</a></div></li></ul></section></div></main></body></html>