<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module provides a framework on top of the normal MIR dataflow framework to simplify the implementation of analyses that track information about the values stored in certain places. We are using the term ‚Äúplace‚Äù here to refer to a `mir::Place` (a place expression) instead of an `interpret::Place` (a memory location)."><title>rustc_mir_dataflow::value_analysis - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-47e7ab555ef2818a.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rustc_mir_dataflow" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0-nightly (58eefc33a 2023-08-24)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-b2d31d2efc7e9b67.css" data-theme-dark-css="dark-3388a2fb2ef8066b.css" data-theme-ayu-css="ayu-8c3c66a6cf12cb2f.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-ef3a2de404864b0b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-b2d31d2efc7e9b67.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-3388a2fb2ef8066b.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../rustc_mir_dataflow/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../rustc_mir_dataflow/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module value_analysis</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‚ÄòS‚Äô to search, ‚Äò?‚Äô for more options‚Ä¶" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">rustc_mir_dataflow</a>::<wbr><a class="mod" href="#">value_analysis</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/rustc_mir_dataflow/value_analysis.rs.html#1-1146">source</a> ¬∑ <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module provides a framework on top of the normal MIR dataflow framework to simplify the
implementation of analyses that track information about the values stored in certain places.
We are using the term ‚Äúplace‚Äù here to refer to a <code>mir::Place</code> (a place expression) instead of
an <code>interpret::Place</code> (a memory location).</p>
<p>The default methods of <a href="trait.ValueAnalysis.html" title="trait rustc_mir_dataflow::value_analysis::ValueAnalysis"><code>ValueAnalysis</code></a> (prefixed with <code>super_</code> instead of <code>handle_</code>)
provide some behavior that should be valid for all abstract domains that are based only on the
value stored in a certain place. On top of these default rules, an implementation should
override some of the <code>handle_</code> methods. For an example, see <code>ConstAnalysis</code>.</p>
<p>An implementation must also provide a <a href="struct.Map.html" title="struct rustc_mir_dataflow::value_analysis::Map"><code>Map</code></a>. Before the analysis begins, all places that
should be tracked during the analysis must be registered. During the analysis, no new places
can be registered. The <a href="struct.State.html" title="struct rustc_mir_dataflow::value_analysis::State"><code>State</code></a> can be queried to retrieve the abstract value stored for a
certain place by passing the map.</p>
<p>This framework is currently experimental. Originally, it supported shared references and enum
variants. However, it was discovered that both of these were unsound, and especially references
had subtle but serious issues. In the future, they could be added back in, but we should clarify
the rules for optimizations that rely on the aliasing model first.</p>
<h2 id="notes"><a href="#notes">Notes</a></h2>
<ul>
<li>
<p>The bottom state denotes uninitialized memory. Because we are only doing a sound approximation
of the actual execution, we can also use this state for places where access would be UB.</p>
</li>
<li>
<p>The assignment logic in <code>State::insert_place_idx</code> assumes that the places are non-overlapping,
or identical. Note that this refers to place expressions, not memory locations.</p>
</li>
<li>
<p>Currently, places that have their reference taken cannot be tracked. Although this would be
possible, it has to rely on some aliasing model, which we are not ready to commit to yet.
Because of that, we can assume that the only way to change the value behind a tracked place is
by direct assignment.</p>
</li>
</ul>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Children.html" title="struct rustc_mir_dataflow::value_analysis::Children">Children</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="struct" href="struct.Map.html" title="struct rustc_mir_dataflow::value_analysis::Map">Map</a></div><div class="desc docblock-short">Partial mapping from <a href="../../rustc_middle/mir/syntax/struct.Place.html" title="struct rustc_middle::mir::syntax::Place"><code>Place</code></a> to <a href="struct.PlaceIndex.html" title="struct rustc_mir_dataflow::value_analysis::PlaceIndex"><code>PlaceIndex</code></a>, where some places also have a <a href="struct.ValueIndex.html" title="struct rustc_mir_dataflow::value_analysis::ValueIndex"><code>ValueIndex</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.PlaceIndex.html" title="struct rustc_mir_dataflow::value_analysis::PlaceIndex">PlaceIndex</a></div><div class="desc docblock-short">This index uniquely identifies a place.</div></li><li><div class="item-name"><a class="struct" href="struct.PlaceInfo.html" title="struct rustc_mir_dataflow::value_analysis::PlaceInfo">PlaceInfo</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">This is the information tracked for every <a href="struct.PlaceIndex.html" title="struct rustc_mir_dataflow::value_analysis::PlaceIndex"><code>PlaceIndex</code></a> and is stored by <a href="struct.Map.html" title="struct rustc_mir_dataflow::value_analysis::Map"><code>Map</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.State.html" title="struct rustc_mir_dataflow::value_analysis::State">State</a></div><div class="desc docblock-short">The dataflow state for an instance of <a href="trait.ValueAnalysis.html" title="trait rustc_mir_dataflow::value_analysis::ValueAnalysis"><code>ValueAnalysis</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.ValueAnalysisWrapper.html" title="struct rustc_mir_dataflow::value_analysis::ValueAnalysisWrapper">ValueAnalysisWrapper</a></div></li><li><div class="item-name"><a class="struct" href="struct.ValueIndex.html" title="struct rustc_mir_dataflow::value_analysis::ValueIndex">ValueIndex</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">This index uniquely identifies a tracked place and therefore a slot in <a href="struct.State.html" title="struct rustc_mir_dataflow::value_analysis::State"><code>State</code></a>.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.StateData.html" title="enum rustc_mir_dataflow::value_analysis::StateData">StateData</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">See <a href="struct.State.html" title="struct rustc_mir_dataflow::value_analysis::State"><code>State</code></a>.</div></li><li><div class="item-name"><a class="enum" href="enum.TrackElem.html" title="enum rustc_mir_dataflow::value_analysis::TrackElem">TrackElem</a></div><div class="desc docblock-short">The set of projection elements that can be used by a tracked place.</div></li><li><div class="item-name"><a class="enum" href="enum.ValueOrPlace.html" title="enum rustc_mir_dataflow::value_analysis::ValueOrPlace">ValueOrPlace</a></div><div class="desc docblock-short">Used as the result of an operand or r-value.</div></li></ul><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ValueAnalysis.html" title="trait rustc_mir_dataflow::value_analysis::ValueAnalysis">ValueAnalysis</a></div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.debug_with_context.html" title="fn rustc_mir_dataflow::value_analysis::debug_with_context">debug_with_context</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.debug_with_context_rec.html" title="fn rustc_mir_dataflow::value_analysis::debug_with_context_rec">debug_with_context_rec</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.excluded_locals.html" title="fn rustc_mir_dataflow::value_analysis::excluded_locals">excluded_locals</a></div><div class="desc docblock-short">Returns all locals with projections that have their reference or address taken.</div></li><li><div class="item-name"><a class="fn" href="fn.iter_fields.html" title="fn rustc_mir_dataflow::value_analysis::iter_fields">iter_fields</a></div><div class="desc docblock-short">Invokes <code>f</code> on all direct fields of <code>ty</code>.</div></li></ul></section></div></main></body></html>