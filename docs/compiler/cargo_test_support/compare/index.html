<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Routines for comparing and diffing output."><title>cargo_test_support::compare - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-47e7ab555ef2818a.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="cargo_test_support" data-themes="" data-resource-suffix="" data-rustdoc-version="1.74.0-nightly (58eefc33a 2023-08-24)" data-channel="nightly" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-b2d31d2efc7e9b67.css" data-theme-dark-css="dark-3388a2fb2ef8066b.css" data-theme-ayu-css="ayu-8c3c66a6cf12cb2f.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-ef3a2de404864b0b.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-b2d31d2efc7e9b67.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-3388a2fb2ef8066b.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../cargo_test_support/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../cargo_test_support/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module compare</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‚ÄòS‚Äô to search, ‚Äò?‚Äô for more options‚Ä¶" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">cargo_test_support</a>::<wbr><a class="mod" href="#">compare</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/cargo_test_support/compare.rs.html#1-785">source</a> ¬∑ <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Routines for comparing and diffing output.</p>
<h2 id="patterns"><a href="#patterns">Patterns</a></h2>
<p>Many of these functions support special markup to assist with comparing
text that may vary or is otherwise uninteresting for the test at hand. The
supported patterns are:</p>
<ul>
<li><code>[..]</code> is a wildcard that matches 0 or more characters on the same line
(similar to <code>.*</code> in a regex). It is non-greedy.</li>
<li><code>[EXE]</code> optionally adds <code>.exe</code> on Windows (empty string on other
platforms).</li>
<li><code>[ROOT]</code> is the path to the test directory‚Äôs root.</li>
<li><code>[CWD]</code> is the working directory of the process that was run.</li>
<li>There is a wide range of substitutions (such as <code>[COMPILING]</code> or
<code>[WARNING]</code>) to match cargo‚Äôs ‚Äústatus‚Äù output and allows you to ignore
the alignment. See the source of <code>substitute_macros</code> for a complete list
of substitutions.</li>
<li><code>[DIRTY-MSVC]</code> (only when the line starts with it) would be replaced by
<code>[DIRTY]</code> when <code>cfg(target_env = &quot;msvc&quot;)</code> or the line will be ignored otherwise.
Tests that work around <a href="https://github.com/rust-lang/cargo/issues/7358">issue 7358</a>
can use this to avoid duplicating the <code>with_stderr</code> call like:
<code>if cfg!(target_env = &quot;msvc&quot;) {e.with_stderr(&quot;...[DIRTY]...&quot;);} else {e.with_stderr(&quot;...&quot;);}</code>.</li>
</ul>
<h2 id="normalization"><a href="#normalization">Normalization</a></h2>
<p>In addition to the patterns described above, the strings are normalized
in such a way to avoid unwanted differences. The normalizations are:</p>
<ul>
<li>Raw tab characters are converted to the string <code>&lt;tab&gt;</code>. This is helpful
so that raw tabs do not need to be written in the expected string, and
to avoid confusion of tabs vs spaces.</li>
<li>Backslashes are converted to forward slashes to deal with Windows paths.
This helps so that all tests can be written assuming forward slashes.
Other heuristics are applied to try to ensure Windows-style paths aren‚Äôt
a problem.</li>
<li>Carriage returns are removed, which can help when running on Windows.</li>
</ul>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.WildStr.html" title="struct cargo_test_support::compare::WildStr">WildStr</a></div><div class="desc docblock-short">A single line string that supports <code>[..]</code> wildcard matching.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.assert_match_exact.html" title="fn cargo_test_support::compare::assert_match_exact">assert_match_exact</a></div><div class="desc docblock-short">Convenience wrapper around <a href="fn.match_exact.html" title="fn cargo_test_support::compare::match_exact"><code>match_exact</code></a> which will panic on error.</div></li><li><div class="item-name"><a class="fn" href="fn.assert_ui.html" title="fn cargo_test_support::compare::assert_ui">assert_ui</a></div><div class="desc docblock-short">Default <code>snapbox</code> Assertions</div></li><li><div class="item-name"><a class="fn" href="fn.collect_json_objects.html" title="fn cargo_test_support::compare::collect_json_objects">collect_json_objects</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.find_json_mismatch.html" title="fn cargo_test_support::compare::find_json_mismatch">find_json_mismatch</a></div><div class="desc docblock-short">Compares JSON object for approximate equality.
You can use <code>[..]</code> wildcard in strings (useful for OS-dependent things such
as paths). You can use a <code>&quot;{...}&quot;</code> string literal as a wildcard for
arbitrary nested JSON (useful for parts of object emitted by other programs
(e.g., rustc) rather than Cargo itself).</div></li><li><div class="item-name"><a class="fn" href="fn.find_json_mismatch_r.html" title="fn cargo_test_support::compare::find_json_mismatch_r">find_json_mismatch_r</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.match_contains.html" title="fn cargo_test_support::compare::match_contains">match_contains</a></div><div class="desc docblock-short">Checks that the given string contains the given contiguous lines
somewhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_contains_n.html" title="fn cargo_test_support::compare::match_contains_n">match_contains_n</a></div><div class="desc docblock-short">Checks that the given string contains the given contiguous lines
somewhere, and should be repeated <code>number</code> times.</div></li><li><div class="item-name"><a class="fn" href="fn.match_does_not_contain.html" title="fn cargo_test_support::compare::match_does_not_contain">match_does_not_contain</a></div><div class="desc docblock-short">Checks that the given string does not contain the given contiguous lines
anywhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_exact.html" title="fn cargo_test_support::compare::match_exact">match_exact</a></div><div class="desc docblock-short">Compares one string against another, checking that they both match.</div></li><li><div class="item-name"><a class="fn" href="fn.match_json.html" title="fn cargo_test_support::compare::match_json">match_json</a></div><div class="desc docblock-short">Checks that the given string of JSON objects match the given set of
expected JSON objects.</div></li><li><div class="item-name"><a class="fn" href="fn.match_json_contains_unordered.html" title="fn cargo_test_support::compare::match_json_contains_unordered">match_json_contains_unordered</a></div><div class="desc docblock-short">Checks that the given string of JSON objects match the given set of
expected JSON objects, ignoring their order.</div></li><li><div class="item-name"><a class="fn" href="fn.match_unordered.html" title="fn cargo_test_support::compare::match_unordered">match_unordered</a></div><div class="desc docblock-short">Checks that the given string contains the given lines, ignoring the order
of the lines.</div></li><li><div class="item-name"><a class="fn" href="fn.match_with_without.html" title="fn cargo_test_support::compare::match_with_without">match_with_without</a></div><div class="desc docblock-short">Checks that the given string has a line that contains the given patterns,
and that line also does not contain the <code>without</code> patterns.</div></li><li><div class="item-name"><a class="fn" href="fn.meta_cmp.html" title="fn cargo_test_support::compare::meta_cmp">meta_cmp</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.normalize_actual.html" title="fn cargo_test_support::compare::normalize_actual">normalize_actual</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">Normalizes the output so that it can be compared against the expected value.</div></li><li><div class="item-name"><a class="fn" href="fn.normalize_expected.html" title="fn cargo_test_support::compare::normalize_expected">normalize_expected</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">Normalizes the expected string so that it can be compared against the actual output.</div></li><li><div class="item-name"><a class="fn" href="fn.normalize_windows.html" title="fn cargo_test_support::compare::normalize_windows">normalize_windows</a><span title="Restricted Visibility">&nbsp;üîí</span> </div><div class="desc docblock-short">Normalizes text for both actual and expected strings on Windows.</div></li><li><div class="item-name"><a class="fn" href="fn.replace_dirty_msvc.html" title="fn cargo_test_support::compare::replace_dirty_msvc">replace_dirty_msvc</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.replace_dirty_msvc_impl.html" title="fn cargo_test_support::compare::replace_dirty_msvc_impl">replace_dirty_msvc_impl</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li><li><div class="item-name"><a class="fn" href="fn.substitute_macros.html" title="fn cargo_test_support::compare::substitute_macros">substitute_macros</a><span title="Restricted Visibility">&nbsp;üîí</span> </div></li></ul></section></div></main></body></html>